<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>tabela online</title>
    <script>
        // Aguarda o carregamento completo do DOM
        document.addEventListener("DOMContentLoaded", async function () {
            try {
                const response = await fetch("https://docs.google.com/spreadsheets/d/1UUXxny78kTZPcg-9HHr_5E8ZB4eFmJadwWLjKgtZVIM/pubhtml?gid=1463259302&single=true");
                const html = await response.text();

                // Cria um elemento temporário para inserir o HTML
                const tempElement = document.createElement("div");
                tempElement.innerHTML = html;

                // Obtém o elemento de classe "ritz"
                const elementoRitz = tempElement.querySelector(".ritz");

                const paiDaTabela = document.querySelector(".tabela");

                // Adiciona o elemento ao seu DOM
                paiDaTabela.appendChild(elementoRitz);


                // Seleciona todas as linhas (tr) da tabela com a classe "waffle"
                var rows = document.querySelectorAll('.waffle tr');

                // Itera sobre cada linha
                rows.forEach(function (row) {
                    // Verifica se a linha tem pelo menos dois filhos
                    if (row.children.length > 1) {
                        // Cria um novo elemento td
                        var newCell = document.createElement('td');

                        // Insere o novo td entre o firstChild e o segundo filho (nth-child(1))
                        row.insertBefore(newCell, row.children[1]);
                    } else {
                        // Se não houver pelo menos dois filhos, insere o novo td no final
                        row.appendChild(newCell);
                    }


                });

                //Previne se acaso tiver algun span dentro das celulas de qualisquer coluna.
                var myCells = document.querySelectorAll('.waffle td');

                myCells.forEach(function (myCell) {
                    // Seleciona todos os spans dentro da célula
                    var spans = myCell.querySelectorAll('span');

                    if (spans.length > 0) {
                        var combinedText = '';

                        // Itera sobre todos os spans e combina o conteúdo de cada um
                        spans.forEach(function (span) {
                            combinedText += span.innerHTML; // Adiciona o conteúdo do span ao texto combinado
                        });

                        // Define o conteúdo da célula como o texto combinado e remove os spans
                        myCell.innerHTML = combinedText.replace(/r\$|R\$/g, '').replace(/junção/, '');
                    }
                });


                ///////////////////////////////////////////////////////////////////////



                // Formatação de valores
                $('td').filter(function () {
                    return $(this).text().toLowerCase().includes('x');
                }).each(function () {


                    var parcelaTexto = $(this).text().toLocaleLowerCase();

                    // Encontra a posição do primeiro "x"
                    var posicaoDoX = parcelaTexto.toLocaleLowerCase().indexOf('x');



                    if (posicaoDoX !== -1) {



                        var valorAntesDoX = parcelaTexto.substring(0, posicaoDoX).trim(); // Valor antes do primeiro "x"
                        var valorDepoisDoX = parcelaTexto.substring(posicaoDoX + 1).trim(); // Valor depois do primeiro "x"

                        // Extraia apenas números do valor antes do "x"
                        var numerosAntesDoX = valorAntesDoX.match(/\d+/g);
                        if (numerosAntesDoX) {
                            numerosAntesDoX = numerosAntesDoX.join(''); // Junta todos os números encontrados
                        } else {
                            numerosAntesDoX = "";
                        }


                        // Copia o valor antigo das células "Prazo" e "Parcelas"
                        var oldPrazo = $(this).closest('tr').find('td:eq(5)').text();
                        var oldParcelas = $(this).closest('tr').find('td:eq(6)').text().replace('junção', '').replace('R$', '').replace('sendo', '');

                        // Adiciona "+" depois dos dois números após uma vírgula, se necessário
                        var decimalpadron = /(\d{1},\d{2})(?![\d,]*\+)/g; // Padrão para encontrar dois números depois de uma vírgula
                        oldParcelas = oldParcelas.replace(decimalpadron, function (match, p1) {
                            // Verifica se há mais números após os dois números decimais e se não há um "+"
                            var index = oldParcelas.indexOf(match) + match.length;
                            if (index < oldParcelas.length && !oldParcelas.includes('+', index)) {
                                return match + '+';
                            }
                            return match;
                        });


                        // Atualize as células da coluna "Prazo" e "Parcelas" com os números extraídos
                        $(this).closest('tr').find('td:eq(5)').text(numerosAntesDoX);
                        $(this).closest('tr').find('td:eq(6)').text(valorDepoisDoX);


                    }

                    var cellText = $(this).text();
                    var newText = cellText.replace(/r\$|R\$/g, '').replace(/junção/, ''); // Remove "R$" ou "r$" e junção.
                    $(this).text(newText);
                });
                //////////////////////////////////////////////////////////////////////////////////////////////////////////


                // Função para adicionar classes às linhas da tabela e definir o atributo "data-value"
                function adicionarClassesTabela() {

                    // Função para remover acentuação e converter para letras minúsculas
                    function normalizeText(text) {
                        return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
                    }

                    $('tr').each(function () {
                        var segundaCelula = $(this).find('td:eq(2)'); // Segunda célula (índice 2)
                        var primeiraCelula = $(this).find('td:eq(1)'); // Primeira célula (índice 1)
                        var textoInterno = segundaCelula.text().trim(); // Obtém o texto interno da segunda célula
                        var textoInterno2 = primeiraCelula.text().trim(); // Obtém o texto interno da primeira célula

                        // Remove espaços em branco, acentuação e converte para letras minúsculas
                        var classeSegundaCelula = normalizeText(textoInterno.replace(/\s+/g, ''));
                        var classePrimeiraCelula = normalizeText(textoInterno2.replace(/\s+/g, ''));

                        // Adiciona o texto interno como classe à linha
                        $(this).addClass(classeSegundaCelula);
                        $(this).addClass(classePrimeiraCelula);

                        // Verifica a célula na posição 6 para adicionar o atributo "data-value"
                        var sextaCelula = $(this).find('td:eq(6)');
                        var textoSextaCelula = sextaCelula.text().trim();

                        // Adiciona "+" depois dos dois números após uma vírgula, se necessário
                        var decimalPattern = /(\d{1},\d{2})(?![\d,]*\+)/g; // Padrão para encontrar dois números depois de uma vírgula
                        textoSextaCelula = textoSextaCelula.replace(decimalPattern, function (match, p1) {
                            // Verifica se há mais números após os dois números decimais e se não há um "+"
                            var index = textoSextaCelula.indexOf(match) + match.length;
                            if (index < textoSextaCelula.length && !textoSextaCelula.includes('+', index)) {
                                return match + '+';
                            }
                            return match;
                        });

                        sextaCelula.text(textoSextaCelula); // Atualiza o texto da célula

                        // Verifica se o valor contém "+" ou "x"
                        if (textoSextaCelula.includes('+') || textoSextaCelula.toLocaleLowerCase().includes('x')) {
                            $(this).attr('data-value', '11');
                        }



                        $('.waffle tr[data-value="11"]').each(function () {
                            var $row = $(this);
                            var value5 = $row.find('td:eq(5)').text().trim();
                            var value6 = $row.find('td:eq(6)').text().trim();

                            // Remover o "+" no final do texto da td:eq(6) se existir
                            if (value6.endsWith('+')) {
                                value6 = value6.slice(0, -1).trim(); // Remove o último caractere "+"
                            }

                            // Criar a variável combinada para "realValue" da td:eq(6)
                            var newValue6 = value5 + 'x' + value6;
                            $row.find('td:eq(6)').attr('realValue', newValue6);

                            // Criar o "realValue" da td:eq(4)
                            var modifiedValue6 = newValue6.replace(/\+/g, '>').replace(/x/g, '>');
                            var parts = modifiedValue6.split('>');
                            var sum = 0;
                            for (var i = 0; i < parts.length; i++) {
                                if (i % 2 == 0) { // Posições ímpares na contagem começam em 0
                                    sum += parseInt(parts[i]);
                                }
                            }
                            $row.find('td:eq(5)').attr('realValue', sum);
                        });


                    });


                }

                // Chama a função para adicionar classes e atributos quando o documento estiver pronto
                $(document).ready(function () {
                    adicionarClassesTabela();
                });









            } catch (error) {
                console.error("Erro ao obter o HTML:", error);
            }




            const coluna3 = document.querySelectorAll('td:nth-child(2)');
            const coluna4 = document.querySelectorAll('td:nth-child(3)');
            const coluna5 = document.querySelectorAll('td:nth-child(4)');

            // Inserir o texto "Seguimento" na célula da coluna 3 da linha 1
            if (coluna4.length > 1) {  // Verificar se há pelo menos 2 elementos na coluna4
                coluna4[0].innerHTML = "Seguimento";
            }

            // Filtra os elementos, excluindo o segundo filho
            const elementosFiltrados = Array.from(coluna3).filter((celula, index) => index !== 1);

            elementosFiltrados.forEach((celula) => {
                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.className = "chk checkbox"; // Adicionei a classe "chk checkbox"
                celula.appendChild(checkbox);
            });

            // Atualiza o innerHTML para "Porto Seguro" nas células da coluna 3 que contenham "porto"
            coluna5.forEach((celula) => {
                if (celula.innerHTML.toLowerCase().match(/porto/i)) {
                    celula.innerHTML = "Porto Seguro";
                }
                if (celula.innerHTML.toLowerCase().match(/ancora|âncora/i)) {
                    celula.innerHTML = "Âncora consorcios";
                }

            });





            //identifica checkbox marcado e desabilita as demais marcas.
            $('input[type=checkbox]').on('change', function () {
                var checks = $("input[type=checkbox]:checked");
                var estaLinha = $(this);
                var deselectAll = document

                // Adicionar classe "disableClick" às linhas que não têm a mesma classe da linha pai
                $("tr").each(function () {
                    if ($(this).attr("class") !== estaLinha.closest("tr").attr("class")) {
                        $(this).addClass("disableClick");

                    }
                });

                // Remover classe "disableClick" de todas as linhas quando nenhum checkbox estiver marcado
                if ($("input[type=checkbox]:checked").length === 0) {
                    $("tr").removeClass("disableClick");

                }

            });






            selecionarTipo.onclick = function () {
                if (select.value === "Veículos") {
                    console.log("Removemos os Imóveis da tabela.");
                    $('.imoveis').closest("tr").addClass('disabled')
                    $('.veiculos').closest("tr").removeClass('disabled')
                } else if (select.value === "Imóveis") {
                    console.log("Removemos os Veículos da tabela.");
                    $('.veiculos').closest("tr").addClass('disabled')
                    $('.imoveis').closest("tr").removeClass('disabled')
                } else if (select.value === "Todos") {
                    console.log("Todos os itens estão disponíveis.")
                    $('.veiculos').closest("tr").removeClass('disabled')
                    $('.imoveis').closest("tr").removeClass('disabled')
                    return;
                }
            }








        });

    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 13px;
        }

        body {
            background-color: black;
            display: flex;
            justify-content: center;
            flex-direction: column;
        }

        button {
            background-color: rgb(190, 190, 190);
            border: none;
            border-radius: 3px;
            padding: 5px;
            box-shadow: 2px 2px 2px #00000030;
            color: #000;
            transition: 0.3s;
        }

        td[realValue] {
            position: relative;
        }

        td[realValue]::before {
            content: attr(realValue);
            position: absolute;
            top: 0;
            left: 0;
            width: 82%;
            height: 100%;
            background-color: rgb(255, 255, 255);
            color: rgb(0, 0, 0);
            opacity: 1;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding-left: 10px;
            padding-right: -5px;
            transition: .3s;



        }



        button:hover:not(.action) {
            transform: scale(1.05);
            background-color: rgb(243, 237, 186);
            z-index: 999;
        }

        .section {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        dialog {
            align-items: start;
            padding: 50px;
            min-height: 700px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border-radius: 20px;
            flex-direction: column;
            gap: 20px;
            box-shadow: 5px 5px 5px #00000070;
            overflow: visible;

        }

        dialog::backdrop {
            background-color: #00000050;
            backdrop-filter: blur(3px);
        }

        .head {
            flex-direction: row;
            display: flex;
        }

        .head img {
            margin: auto;
        }

        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            padding: 20px;

        }

        .container img {
            width: 150px;
        }



        select {
            padding: 5px 40px;
            margin: 10px;
        }

        .disabled {
            display: none;
        }

        .disableClick:not(tr:first-child),
        .disableClick td[realValue]::before {
            cursor: not-allowed;
            background-color: #e7e7e7;
            pointer-events: none;
            user-select: none;
            color: #00000080;
            transition: .5s;
        }


        dialog h1 {
            font-size: 25px;
            text-transform: uppercase;
            font-weight: 800;
            padding-bottom: 15px;
            border-bottom: 1px solid black;
            margin-bottom: 0;
            overflow: auto;

        }

        #res,
        #res p {
            color: #000;
            font-size: 16px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.322);
            padding: 0;
            margin: 0;
            text-align: left;
            display: flex;
            align-items: flex-start;
            justify-content: flex-start;
            flex-direction: column;
        }


        .comissoes,
        .comissoes p {
            display: flex;
            flex-wrap: nowrap;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: left;
            font-size: 18px;
            margin: 15px;
        }

        .comissoes p span {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            font-size: 18px;
            font-weight: 900;
        }

        .botoesComissoes {
            display: grid;

        }

        .selects {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            overflow: hidden;
            border-radius: 5px 0 5px 0;
            box-shadow: 3px 3px 3px #00000030;
        }

        .selects button {
            background-image: linear-gradient(120deg, #fff, #6d6d6d);
            width: 100%;
            height: 105%;
            box-shadow: none;
            margin: 0;
            border: none;
            height: 100%;
            border-radius: 0;
        }

        select {
            border: none;
            padding: 5px;
            width: 100%;
            text-align: center;
            margin: 0;
        }





        .controles {
            display: flex;
            flex-direction: row;
            width: 100%;
            align-items: center;
            justify-content: space-between;
            background-color: goldenrod;
            overflow: visible;
            padding-top: 30px;
        }

        .controles .cont {
            width: min(800px, 90%);
            display: flex;
            flex-direction: row;
            margin: auto;
        }

        .controles p {
            color: #ffffff;
            margin-bottom: 20px;
        }

        /*pesquisar
	*/
        .pesquisa {
            display: flex;
            width: 100%;
            background-color: goldenrod;
            overflow: hidden;
            border-radius: 10px;
            box-shadow: 3px 3px 3px #00000040;
        }

        .fa-magnifying-glass {
            background-color: goldenrod;
            font-size: 20px;
            color: white;
            margin: auto 5px;
            width: 35px;
            transition: .5s;
        }

        #searchInput {
            width: 100%;
            margin: 0 auto;
            text-align: center;
            padding: 10px;
            transition: .5s;
        }

        .pesquisa:hover .fa-magnifying-glass {
            transform: translate(-50px);
        }

        .pesquisa:hover #searchInput,
        #searchInput:focus {
            transform: translate(-20px);
            width: calc(100% +100px);
            z-index: 100;
        }



        /* Tabela */
        .ritz {
            max-width: 800px;
            background-color: white;
            max-height: 100vh;
            overflow: scroll;
            border-radius: 6px;
            display: flex;
            justify-content: center;
            margin: auto;
        }

        .ritz::-webkit-scrollbar {
            background-color: rgb(255, 255, 255);
            width: 10px;
        }

        .ritz::-webkit-scrollbar-thumb {
            background-color: rgb(223, 176, 23);
            border-radius: 5px;
        }

        .waffle {
            display: flex;
            flex-direction: column !important;
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            display: none;
        }

        th:first-child {
            display: none;
        }

        tr td {
            border: .4px solid rgba(128, 128, 128, 0.486);
            padding: 10px;
            height: min(50px, 100%);
            width: 12.5%;
        }

        tr:not(tr:nth-child(1)) {
            transition: .3s;
        }

        tr:hover:not(tr:nth-child(1)),
        tr:hover td[realValue]::before {
            transform: scale(1.01);
            background-color: #ffe600;
            cursor: pointer;
        }

        td[realValue]:not(.modal td) {
            color: transparent;
            padding: 20px;
        }

        tr:nth-child(1) {
            background-color: #e4cd00;
            pointer-events: none;
            position: sticky;
            top: 0;
            z-index: 999;
        }




        section {
            margin: 0 auto;
            width: 800px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 50px;
        }

        .submit {
            color: #fff;
            background-color: green;
            width: 20%;
            height: 30px;
            box-shadow: 0 3px 5px #00000070;
            border: none;
            position: relative;
            cursor: pointer;
            transition: 0.2s;
        }

        .submit:hover {
            box-shadow: 0 0 0 0;
            top: 2px;
        }

        .action {
            border: none;
            margin: 0 auto !important;
            width: 200px;
            min-height: 55px;
            color: #000;
            font-weight: 900;
            background-image: linear-gradient(100deg, rgb(255, 174, 0) 0 40%, #ffe600 55%, rgb(255, 174, 0) 70% 100%);
            border-radius: 5px;
            background-size: 300% 100%;
            box-shadow: 2px 2px 5px #00000030;
            transition: 0.5s ease-in-out;
            position: fixed;
            bottom: 40px;
            z-index: 999;
            right: 10px;
        }

        .action:hover {
            background-position: 100%;
            scale: 1.1;
        }

        .btn-close {
            font-weight: 900;
            font-family: "montserrat", sans-serif;
            color: #fff;
            background-color: red;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-shadow: 2px 2px 2px 5px #000;
            box-shadow: 0 0 5px 1px #00000090;
            position: absolute;
            top: -15px;
            right: -15px;
            cursor: pointer;
        }

        /* Estilos para o modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            min-width: 100dvw;
            min-height: 100dvh;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9999;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
        }

        .modal-content td {
            padding: 10px 5px;
        }

        .modal-content td::before {
            display: none;

        }

        #create_pdf {
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
        }

        #deselectAll {
            position: fixed;
            padding: 20px;
            margin: 20px;
            bottom: 20px;
            background-color: #b83939;
            animation: surgir .5s ease-in-out;
            transition: .5s;
            z-index: 999;
        }



        @keyframes surgir {
            0% {
                left: -300px;
            }

            100% {
                left: 0;
            }

        }

        #botoes_download {
            flex-direction: column;

        }

        #exportButtonsFora {
            overflow: hidden;
        }

        #exportButtons {
            display: flex;
            flex-direction: column;
            margin-top: 15px;
            overflow: hidden;
            transition: transform .7s;
            gap: 3px;
        }

        #exportButtons button {
            position: relative;
        }

        #copyAndShare {
            margin: 5px auto !important;
            background-color: rgb(24, 211, 24);
            color: #ffffff;
            padding: 5px 10px;
            border-radius: 10px;
            border: none;
            position: relative;
            left: 50%;
            transform: translateX(-50%);
        }

        #copyAndShare:hover {
            background-color: green;
        }

        @media (max-width: 767px) {

            .controles .cont {
                flex-direction: column;
            }

            .modal {
                width: 100%;
            }

            .modal-content {
                width: 90%;
                display: flex;
                justify-content: center;
                align-items: center;
                flex-direction: column;

            }

            .modal-content table {
                transform: scale(0.6);
                margin: 0;

            }

            section {
                width: 100%;
            }

            dialog {
                width: 95%;
                min-height: 95%;
                margin: 10px;
                overflow-y: scroll;
            }

            .ritz {
                width: 95%;
                background-color: white;
                max-height: 100%;
                overflow: scroll;
                border-radius: 6px;
                display: flex;
                justify-content: center;
                margin: auto;
            }

            .waffle {
                width: 100%;
            }

            .container {
                width: 100%;
                height: 100%;
            }

            .head {
                width: 100%;
            }

            .controles {
                height: 100%;
                flex-direction: column;
            }

            dialog h1 {
                font-size: 22px;
            }

            #res,
            #res p {
                font-size: 16px;
            }

            .action {
                min-width: 90px;
                padding: 3px;
                right: 10px;
            }

        }

        .caixa-toggle {
            width: 100%;
            background-color: #fff;
            margin-bottom: 10px;
            padding: 10px 5px;
            border-radius: 6px;
        }

        .selects {
            width: 100%;
        }

        .btn-close {
            top: 2px;
            right: 2px;
        }
    </style>



<body>

    <!--Cabeçalho do site.-->
    <header>
        <section class="head">
            <div class="container">
                <img src="http://designerluiscoms.com/wp-content/uploads/2024/07/logo-contemplabens.webp" alt="">

        </section>
    </header>

    <section class="controles">
        <div class="cont">
            <div class="container apresent">
                <p>ESTOQUE CONSÓRCIOS CONTEMPLADOS CONTEMPLABENS</p>

                <div class="caixa-toggle">
                    <label for="minValue">Valor Mínimo:</label>
                    <input type="range" id="minValue" min="0" max="1000000" step="100" />
                    <div id="minValueDisplay" class="value-display">0,00</div>

                    <label for="maxValue">Valor Máximo:</label>
                    <input type="range" id="maxValue" min="0" max="1000000" step="100" />
                    <div id="maxValueDisplay" class="value-display">1.000.000,00</div>

                    <button id="filterBtn">Filtrar Entrada</button>
                </div>
            </div class="container">

            <!--Pesquisa global-->
            <div class="container valorEntrada">
                <!--Filtros de valor.-->



                <div class="pesquisa">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input id="searchInput" type="text" placeholder="Pesquisar Administradora...">
                </div>

                <br>

                <div class="container">
                    <p>O que você precisa?</p>
                    <div class="selects">
                        <select id="select" name="select">
                            <option value="Todos">Todos</option>
                            <option value="Veículos">Veículos</option>
                            <option value="Imóveis">Imóveis</option>
                        </select>
                        <button class="selecionarTipo" onclick="selecionarTipo()">Selecionar</button>
                    </div>

                </div>

            </div>
        </div>
        </div>

    </section>

    <button id="deselectAll">Desmarcar Todos</button>




    <!--Botão openModal-->
    <section id="botoes_download">
        <button class="action">Calcular Tabelas</button>
        <!-- Botão de alternância -->
        <button id="toggleExportButtons">Baixar tabela completa.</button>

        <div id="exportButtonsFora">
            <div id="exportButtons" style="transform: translateY(-150px);">
                <button onclick="exportTableToPDF('tabela_contemplabens.pdf')">Baixar PDF</button>
                <button id="exportButton">Baixar Excel</button>
                <button id="download-csv">Baixar CSV</button>
            </div>
        </div>


    </section>


    <script>

        //botão cascata.
        document.getElementById('toggleExportButtons').addEventListener('click', function () {
            var exportButtons = document.getElementById('exportButtons');
            var buttonMostrar = document.getElementById('toggleExportButtons');

            if (exportButtons.style.transform === 'translateY(-150px)') {
                exportButtons.style.transform = 'translateY(0)';
                buttonMostrar.innerHTML = `<i class="fa-regular fa-circle-xmark"></i> Ocultar Botões de download`;
                buttonMostrar.style.backgroundColor = 'red';
            } else {
                exportButtons.style.transform = 'translateY(-150px)';
                buttonMostrar.textContent = 'Baixar tabela completa.';
                buttonMostrar.style.backgroundColor = '#ccc'
            }
        });


        // Função para buscar dados da tabela HTML com a classe .waffle
        function fetchHTMLTableData() {
            const rows = [];
            const $table = $('.waffle'); // Seleciona a tabela com a classe .waffle

            // Clona a tabela original para evitar modificações
            const $tableClone = $table.clone();

            // Itera sobre as linhas da tabela clonada
            $tableClone.find('tr').each(function () {
                const currentRow = [];

                // Remove a primeira e segunda célula da linha na tabela clonada
                $(this).find('th:eq(0), td:eq(0)').remove(); // Remove a primeira célula
                //$(this).find('th:eq(0), td:eq(0)').remove(); // Remove a segunda célula 

                $(this).find('th, td').each(function () {
                    // Verifica se a célula tem o atributo 'realValue'
                    const realValue = $(this).attr('realValue');
                    if (realValue !== undefined) {
                        // Usa o valor do atributo 'realValue' se existir
                        currentRow.push(realValue.trim());
                    } else {
                        // Caso contrário, usa o texto interno da célula
                        currentRow.push($(this).text().trim());
                    }
                });

                if (currentRow.length > 0) {
                    rows.push(currentRow);
                }
            });

            return rows;
        }


        //exclusivo para o csv
        function copiarETrocarValoresNaTabela() {
            // Clona a tabela original
            const tabelaOriginal = document.querySelector('.waffle');
            const tabelaClone = tabelaOriginal.cloneNode(true);

            // Substitui o innerHTML nas células clonadas
            const rows = tabelaClone.querySelectorAll('tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td[realValue]');
                cells.forEach(cell => {
                    cell.innerHTML = cell.getAttribute('realValue');
                });

                // Remove a primeira e segunda célula de cada linha
                if (row.children.length > 1) {
                    row.removeChild(row.children[0]); // Remove a primeira célula
                }
                if (row.children.length > 1) {
                    row.removeChild(row.children[0]); // Remove a segunda célula (agora que a primeira já foi removida)
                }
            });

            return tabelaClone;
        }


        // Exportar para PDF
        function exportTableToPDF(filename) {
            const rows = fetchHTMLTableData();

            var { jsPDF } = window.jspdf;
            var doc = new jsPDF('p', 'pt', 'a4');
            doc.autoTable({
                head: [rows[0]],
                body: rows.slice(1),
                styles: { halign: 'center', valign: 'middle' }
            });

            doc.save(filename);
        }

        //Exportar para EXCELL
        document.getElementById('exportButton').addEventListener('click', function () {
            // Função que carrega os dados da tabela
            const rows = fetchHTMLTableData().map(row => {
                return row.map(cell => {
                    // Adiciona uma quebra de linha e um espaço antes do '+' e um espaço após
                    return cell.replace(/\+/g, '\n +'); 
                });
            });

            var wb = XLSX.utils.book_new(); // Cria um novo livro do Excel
            var ws = XLSX.utils.aoa_to_sheet(rows); // Converte o array de arrays (rows) em uma planilha

            // Função para calcular o número de quebras de linha
            const getBreaksCount = (cell) => (cell.match(/\n/g) || []).length;

            // Ajustar a altura das linhas baseado no número de quebras de linha
            ws['!rows'] = rows.map(row => {
                let maxBreaks = Math.max(...row.map(cell => getBreaksCount(cell))); // Conta as quebras de linha em cada célula da linha
                return { hpt: 15 + maxBreaks * 15 }; // Altura padrão de 15pt, +15pt por cada quebra de linha
            });

            // Habilitar a quebra de linha (wrap text) nas células
            Object.keys(ws).forEach(key => {
                if (key[0] !== '!') {
                    ws[key].s = { alignment: { wrapText: true } }; // Ativa wrapText
                }
            });

            XLSX.utils.book_append_sheet(wb, ws, "Sheet JS"); // Adiciona a planilha ao livro do Excel
            XLSX.writeFile(wb, 'tabela_contemplabens.xlsx'); // Baixa o arquivo Excel
        });



        // Função para exportar a tabela como CSV
        function downloadCSV() {
            const tabelaClone = copiarETrocarValoresNaTabela(); // Usa a cópia da tabela

            let csvContent = "";
            const rows = tabelaClone.querySelectorAll('tr');

            rows.forEach((row, rowIndex) => {
                const cols = row.querySelectorAll('td, th');
                const rowContent = [];

                cols.forEach((col) => {
                    let cellText = col.innerText;

                    // Envolver o texto da célula com aspas duplas se contiver quebra de linha ou vírgula
                    if (cellText.includes(',') || cellText.includes('\n')) {
                        cellText = `"${cellText.replace(/"/g, '""')}"`;
                    }

                    rowContent.push(cellText);
                });

                csvContent += rowContent.join(",") + "\n";
            });

            // Criar um blob e fazer o download do arquivo CSV
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");

            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "tabela.csv");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }


        document.getElementById('download-csv').addEventListener('click', downloadCSV);




    </script>





    <dialog>
        <div id="valorCotas">
            <h1>Junção de cotas</h1>
            <div id="res">Aqui vão ficar suas informações de cotas</div>
            <div class="comissoes">
            </div>
        </div>

        <button class="btn-close">X</button>
        <p>valor da comissão:<br><span id="result">0</span></p><br>
        <div class="botoesComissao">
            <button class="percentInput" value="0">0%</button>
            <button class="percentInput" value="1">1%</button>
            <button class="percentInput" value="2">2%</button>
            <button class="percentInput" value="3">3%</button>
            <button class="percentInput" value="4">4%</button>
            <button class="percentInput" value="5">5%</button>
            <button class="percentInput" value="6">6%</button>
            <button class="percentInput" value="7">7%</button>
            <button class="percentInput" value="8">8%</button>
            <button class="percentInput" value="9">9%</button>
            <button class="percentInput" value="10">10%</button>
        </div>




        <button type="button" class="btn btn-primary" id="copyAndShare">Compartilhar no WhatsApp</button>
        <button id="create_pdf">Gerar PDF</button>
    </dialog>


    <div class="tabela"></div>




    <footer><br><br>
        <center>
            <p>
                <font color="#fff">CONTEMPLABENS 2024® | TODOS OS DIREITOS RESERVADOS. <BR></BR>
                    CNPJ 26.756.365/0001-34<br><br>

                    Rua Nuno Álvares Pereira número 600
                    São José do Rio preto
                    Estado São Paulo<br><br>
                    desenvolvido por <a style="color: rgb(109, 109, 255);" href="https://designerluiscoms.com/"
                        target="_blank">Adobra design ®</a></font><br>

            </p>
        </center><br><br>
    </footer>

    <!--script openModal-->
    <script>




        //variaveis globais

        const button = document.querySelector(".action")
        const buttonClose = document.querySelector(".btn-close")
        const table = document.querySelector(".waffle")
        const res = document.querySelector('#res')
        const modal = document.querySelector("dialog")
        var select = document.querySelector("#select");
        var selecionarTipo = document.querySelector(".selecionarTipo")
        var veiculos = document.querySelectorAll(".veiculos")
        var imoveis = document.querySelectorAll(".imoveis")
        var checks = document.querySelectorAll(".checkbox")
        var checksMark = $("input[type=checkbox]:checked")
        const secondCells = document.querySelectorAll("td:nth-child(2)")
        const secondCell = secondCells.innerHTML;

        //Valor que guarda os dados do select adcionado.

        var adminNew = [];
        var checksGuard = [];
        var creditoEnd;
        var entradaEnd;
        var totalEnd;
        var parcelasEnd;
        var valorDevedorEnd;




        //Valores de JQuery dentro do Javascript
        /*Aqui estão todas as informações importantes de somas
        e variáveis guardadas.*/





        //quando o documento for aberto.

        $(document).ready(function () {




            var currentRow = $(this);
            var ADM = currentRow.find("td:eq(2)").html();




            $('input[type=checkbox]').on('change', function () {
                var checks = $("input[type=checkbox]:checked");
                var estaLinha = $(this);

                var desSelecionarTodos = document.getElementById("deselectAll")

                if ($("input[type=checkbox]:checked").length >= 1) {

                    desSelecionarTodos.style.display = 'block'



                }

                // Adicionar classe "disableClick" às linhas que não têm a mesma classe da linha pai
                $("tr").each(function () {
                    if ($(this).attr("class") !== estaLinha.closest("tr").attr("class")) {
                        $(this).addClass("disableClick");

                    }
                });

                // Remover classe "disableClick" de todas as linhas quando nenhum checkbox estiver marcado, exceto "toggleFilter"
                if ($("input[type=checkbox]:checked").length === 0) {
                    $("tr").removeClass("disableClick");
                    desSelecionarTodos.style.display = 'none'
                }
                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////					
            });



        })


        $("#searchInput").on("keyup", function () {
            const searchTerm = $(this).val().toLowerCase().trim();

            $(".waffle tr").each(function () {
                const rowClasses = $(this).attr("class");
                $(this).toggle(rowClasses && rowClasses.toLowerCase().includes(searchTerm));
            });
        });

        $("#searchInputMin").on("keyup", function () {
            const searchTerm = $(this).val().toLowerCase().trim();

            $(".waffle tr").each(function () {
                const rowClasses = $(this).attr("class");
                $(this).toggle(rowClasses && rowClasses.toLowerCase().includes(searchTerm));
            });
        });

        $("#searchInputMax").on("keyup", function () {
            const searchTerm = $(this).val().toLowerCase().trim();

            $(".waffle tr").each(function () {
                const rowClasses = $(this).attr("class");
                $(this).toggle(rowClasses && rowClasses.toLowerCase().includes(searchTerm));
            });
        });


        document.addEventListener("DOMContentLoaded", function () {
            selecionarTipo.onclick = function () {
                const rows = $(".waffle tr");

                if (select.value === "Veículos") {
                    rows.each(function (index) {
                        if (index === 1) return; // Ignora a primeira linha
                        if (!$(this).hasClass('veículos')) {
                            $(this).addClass('disabled');
                        } else {
                            $(this).removeClass('disabled');
                        }
                    });
                } else if (select.value === "Imóveis") {
                    rows.each(function (index) {
                        if (index === 1) return; // Ignora a primeira linha
                        if (!$(this).hasClass('imóveis')) {
                            $(this).addClass('disabled');
                        } else {
                            $(this).removeClass('disabled');
                        }
                    });
                } else if (select.value === "Todos") {
                    rows.removeClass('disabled');
                }
            };




        });


        //botão para desmarcar os checks

        document.getElementById('deselectAll').onclick = function () {
            var checkboxes = document.querySelectorAll("input[type=checkbox]");
            checkboxes.forEach(function (checkbox) {
                checkbox.checked = false;
                $("tr").removeClass("disableClick");
            });


        };






        function parseCurrency(value) {
            if (typeof value === 'string' && value.trim() !== '') {
                return parseFloat(value.replace(/\./g, '').replace(',', '.')) || 0;
            }
            return 0;
        }

        function formatNumber(value) {
            return new Intl.NumberFormat('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }

        function formatInteger(value) {
            return Math.round(value).toString();
        }

        button.onclick = function () {
            console.clear();

            var aData = [];
            var checks = $("input[type=checkbox]:checked");
            var formattedTotal11;
            $("#result").html(`selecione um valor`);
            $(".entrada").html(``);

            $("tr").each(function () {
                var obj = {};
                var currentRow = $(this);
                var Tipo = currentRow.find("td:eq(1)").html();
                var ADM = currentRow.find("td:eq(2)").html();
                var Credito = currentRow.find("td:eq(3)").html();
                var Entrada = currentRow.find("td:eq(4)").html();
                var Prazo = currentRow.find("td:eq(5)").html();
                var Parcelas = currentRow.find("td:eq(6)").html();
                var Cod = currentRow.find("td:eq(7)").html();
                var Vencimentos = currentRow.find("td:eq(8)").html();

                if (currentRow.attr("data-value") === "11") {
                    if (currentRow.find(".checkbox").is(":checked")) {
                        var multiplicadores = [];
                        var valoresMultiplicados = [];
                        var valorTotalMultiplicadores = {};
                        var valorTotalParcelas = {};

                        let newCount = Parcelas.split('+').join('>');
                        let newCount2 = newCount.split('x').join('>');
                        let results = newCount2.split('>');

                        let array1 = [];
                        let array2 = [Prazo];

                        for (let i = 0; i < results.length; i++) {
                            if (i % 2 === 0) {
                                array1.push(results[i].trim());
                            } else {
                                array2.push(results[i].trim());
                            }
                        }

                        array2 = array2.map(parseCurrency);

                        let newArray = [array2[0]];

                        for (let i = 1; i < array2.length; i++) {
                            newArray.push(newArray[i - 1] + array2[i]);
                        }

                        let novoArrayParcelas = [];
                        for (let i = 0; i < array1.length - 1; i++) {
                            let diff = parseCurrency(array1[i]) - parseCurrency(array1[i + 1]);
                            novoArrayParcelas.push(diff);
                        }

                        novoArrayParcelas.push(parseCurrency(array1[array1.length - 1]));

                        let formattedNovoArrayParcelas = novoArrayParcelas.map(formatNumber);

                        let firstPush = true;
                        for (let i = 0; i < newArray.length && i < formattedNovoArrayParcelas.length; i++) {
                            if (firstPush) {
                                aData.push({
                                    Tipo: Tipo,
                                    ADM: ADM,
                                    Credito: formatNumber(parseCurrency(Credito)),
                                    Entrada: formatNumber(parseCurrency(Entrada)),
                                    Prazo: formatInteger(newArray[i]),
                                    Parcelas: formattedNovoArrayParcelas[i],
                                    Cod: Cod,
                                    Vencimentos: Vencimentos
                                });
                                firstPush = false;
                            } else {
                                aData.push({
                                    Tipo: "",
                                    ADM: "",
                                    Credito: "",
                                    Entrada: "",
                                    Prazo: formatInteger(newArray[i]),
                                    Parcelas: formattedNovoArrayParcelas[i],
                                    Cod: "",
                                    Vencimentos: ""
                                });
                            }
                        }
                    }
                } else {
                    obj.Tipo = Tipo;
                    obj.ADM = ADM;
                    obj.Credito = formatNumber(parseCurrency(Credito));
                    obj.Entrada = formatNumber(parseCurrency(Entrada));
                    obj.Prazo = formatInteger(Prazo);
                    obj.Parcelas = formatNumber(parseCurrency(Parcelas));
                    obj.Cod = Cod;
                    obj.Vencimentos = Vencimentos;
                }

                if (currentRow.find(".checkbox").is(":checked")) {
                    if (parseInt(obj.Prazo) > 0) {
                        aData.push(obj);


                    }
                }

                console.log(`Esse é o aData ${JSON.stringify(aData, null, 2)}`);
            });

            var somaParcelas = aData.reduce(function (acc, obj) {
                return acc + parseCurrency(obj.Parcelas);
            }, 0);

            var totalCredito = aData.reduce(function (acc, obj) {
                return acc + parseCurrency(obj.Credito);
            }, 0);

            var totalEntrada = aData.reduce(function (acc, obj) {
                return acc + parseCurrency(obj.Entrada);
            }, 0);

            var totalParcelasMultiplicadas = aData.reduce(function (acc, obj) {
                var parcela = parseCurrency(obj.Parcelas);
                var prazo = parseInt(obj.Prazo);
                return acc + (parcela * prazo);
            }, 0);

            var totalParcelas = aData.reduce(function (acc, obj) {
                return acc + parseCurrency(obj.Parcelas);
            }, 0);

            var totalFinal = totalParcelasMultiplicadas + totalEntrada + (formattedTotal11 || 0);

            var formattedCredito = totalCredito.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            var formattedEntrada = totalEntrada.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            var formattedTotal = totalFinal.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            var formattedParcelas = totalParcelas.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            var valorDevedor = totalParcelasMultiplicadas.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

            creditoEnd = formattedCredito;
            entradaEnd = formattedEntrada;
            totalEnd = formattedTotal;
            parcelasEnd = formattedParcelas;
            parcelasSomadas = somaParcelas.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            valorDevedorEnd = valorDevedor;

            $('.percentInput').on('click', function () {
                var inputValueNotFormatted = parseFloat($(this).val());
                var inputValue = inputValueNotFormatted / 100;

                var creditoEndNumber = parseCurrency(creditoEnd);
                var entradaEndNumber = parseCurrency(entradaEnd);
                var valorComissao = inputValue * creditoEndNumber;

                var formattedComissao = valorComissao.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                var comissaoAdicionada = valorComissao + entradaEndNumber;
                var formattedComissaoAdicionada = comissaoAdicionada.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                $("#result").html(`${formattedComissao} R$ → ${inputValueNotFormatted}%`);
                $(".entrada").html(`${formattedComissaoAdicionada}`);
            });

            modal.showModal();

            // Seleciona todas as linhas com checkboxes marcados
            const checkedRows = Array.from(document.querySelectorAll("input[type=checkbox]:checked")).map(checkbox => {
                return checkbox.closest('tr'); // Assume que o checkbox está dentro de uma <tr>
            });

            const formattedContent = checkedRows.map(row => {
                // Seleciona as células das colunas desejadas
                const tds = row.querySelectorAll('td');
                const credito = tds[3].innerText.trim(); // Ajuste o índice conforme necessário
                const entrada = tds[4].innerText.trim();
                //const parcelas = tds[4].innerText.trim();
                const prazo = tds[5].innerText.trim();
                const outrasParcelas = tds[6].innerText.trim();

                return `<p><strong>Crédito: </strong> ${credito}</p>`;
                //return `<p><strong>Crédito</strong> ${credito}: <strong>Entrada:</strong> ${entrada} + ${prazo}x de ${outrasParcelas}</p>`; // formatação antiga
            }).join('<br>');



            var prazos = aData.map(obj => parseInt(obj.Prazo) || 0);
            var parcelas = aData.map(obj => parseCurrency(obj.Parcelas) || 0);
            var prazosDistintos = [...new Set(prazos)];
            var parcelasDistintas = [...new Set(parcelas)];
            var menorPrazo = Math.min(...prazos);
            var maiorPrazo = Math.max(...prazos);
            var prazoRestante = maiorPrazo - menorPrazo;
            var objMenorPrazo = aData.find(obj => parseInt(obj.Prazo) === menorPrazo);
            var objMaiorPrazo = aData.find(obj => parseInt(obj.Prazo) === maiorPrazo);

            let linhas = aData.map(function (obj) {
                return {
                    prazo: parseInt(obj.Prazo) || 0,
                    parcelas: parseCurrency(obj.Parcelas) || 0
                };
            });

            // Excluir itens com prazo igual a 0
            linhas = linhas.filter(linha => linha.prazo > 0);

            console.log("Linhas antes de ordenar:", linhas);

            linhas.sort((a, b) => a.prazo - b.prazo);

            console.log("Linhas depois de ordenar:", linhas);

            let resultado = [];
            let total = 0;

            while (linhas.length > 1) {
                let primeiraConta = linhas[0].prazo;
                let somaParcelas = linhas.reduce((acc, linha) => acc + linha.parcelas, 0);
                total += somaParcelas * primeiraConta;

                resultado.push(`${formatInteger(primeiraConta)}x ${formatNumber(somaParcelas)}`);

                linhas = linhas.filter(linha => linha.prazo !== primeiraConta);

                linhas.forEach(linha => linha.prazo -= primeiraConta);
            }

            if (linhas.length === 1) {
                total += linhas[0].parcelas * linhas[0].prazo;
                resultado.push(`${formatInteger(linhas[0].prazo)}x ${formatNumber(linhas[0].parcelas)}<br>`);
            }


            let resultadoFormatado = resultado.filter(r => r !== 'NaNx 0,00<br>').join('<br>+');

            $('#valor-total').text(`Valor Total: ${total.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`);

            if (aData.length == 1) {
                res.innerHTML = `
<p><strong>Administradora</strong> ${aData[0].ADM}<br>
<strong>Categoria: </strong>${aData[0].Tipo}<br>
<strong><p>Crédito: </strong>${creditoEnd}<br>
<strong>Entrada:</strong> <span class="entrada">${entradaEnd}</span>

<strong>Parcelas: </strong>${resultadoFormatado}</p><br> 

<strong>Saldo Devedor:</strong> ${valorDevedorEnd}<br><br>
<strong>Você selecionou</strong> ${checkedRows.length} carta(s).
${formattedContent}`;
            } else if (aData.length > 1) {
                var parcelaMenor = parseCurrency(objMenorPrazo.Parcelas) || 0;
                var parcelaSubtraida = (somaParcelas - parcelaMenor);

                res.innerHTML = `<p><strong>Administradora</strong> ${aData[0].ADM}<br>
<strong>Categoria: </strong>${aData[0].Tipo}<br>
<strong><p>Crédito: </strong>${creditoEnd}<br>
<strong>Entrada:</strong> <span class="entrada">${entradaEnd}</span>

<strong>Parcelas: </strong>${resultadoFormatado}</p><br>

<strong>Saldo Devedor:</strong> ${valorDevedorEnd}<br><br>
<strong>Você selecionou</strong> ${checkedRows.length} carta(s)
${formattedContent}`;
            }

            $('#valor-total').text(`Valor Total: ${total.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`);


            $("#descer").click(function () {
                $('html, body').animate({
                    scrollTop: $("#descerAncora").offset().top
                }, 2000);
            });

            $("#voltar").click(function () {
                $('html, body').animate({
                    scrollTop: $("#voltarAncora").offset().top
                }, 2000);
            });
        };








        //botão para fechar a janela de soma
        buttonClose.onclick = function () {
            res.innerHTML = ''
            modal.close()
            var aData = '';
        }



        $("#create_pdf").click(function () {

            var pdf = new jsPDF();
            var minhaData = new Date()

            pdf.fromHTML($('dialog').get(0), 20, 20, {

                'width': 500

            });

            pdf.save(`cotas_somadas_${minhaData}.pdf`);




        });

        $('#copyAndShare').click(function () {
            // Seleciona o HTML do elemento
            var htmlContent = $('#valorCotas').html();

            // Remove todas as tags HTML e preserva as quebras de linha
            var text = htmlContent
                .replace(/<br\s*\/?>/gi, "\n")  // Substitui <br> por quebras de linha
                .replace(/<\/p>/gi, "\n\n")  // Adiciona duas quebras de linha no final de cada parágrafo
                .replace(/<\/div>/gi, "\n\n")  // Adiciona duas quebras de linha no final de cada div
                .replace(/<[^>]+>/g, "")  // Remove todas as outras tags HTML
                .replace(/^\s+/gm, "")  // Remove espaços em branco no início de cada linha
                .replace(/(\n\s+)/g, "\n")  // Remove espaços em branco após quebras de linha
                .trim();  // Remove espaços em branco desnecessários no início e no fim do texto

            // Adiciona uma linha em branco após a primeira linha
            var lines = text.split("\n");
            if (lines.length > 1) {
                lines.splice(1, 0, ""); // Adiciona uma linha em branco após a primeira linha
            }

            // Adiciona uma linha em branco após a quinta linha
            if (lines.length > 5) {
                lines.splice(6, 0, ""); // Adiciona uma linha em branco após a quinta linha
            }

            // Adiciona uma linha em branco antes da palavra "Saldo"
            text = lines.join("\n");
            text = text.replace(/\nSaldo/, "\n\nSaldo").replace(/\nVocê/, "\n\nVocê").replace(/Junção de cotas/, "*Junção de cotas*");

            // Criar uma textarea temporária para copiar o texto
            var tempTextarea = document.createElement('textarea');
            tempTextarea.style.position = 'absolute';
            tempTextarea.style.left = '-9999px';
            tempTextarea.style.whiteSpace = 'pre-wrap'; // Garante a preservação dos espaços em branco e quebras de linha
            tempTextarea.value = text;
            document.body.appendChild(tempTextarea);
            tempTextarea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextarea);

            // Abrir WhatsApp com o texto copiado
            var whatsappUrl = 'https://wa.me/?text=' + encodeURIComponent(text);
            window.open(whatsappUrl, '_blank');
        });






        $(document).ready(function () {
            $(document).on('click', '.waffle tr', function (e) {
                if ($(e.target).is('td:nth-child(2)') || $(e.target).is('input[type="checkbox"]')) {
                    return;
                }

                const linhaClonada = $(this).clone();
                const cabeca = $('.waffle tr:nth-child(1)').clone();

                const parcelasText = linhaClonada.find('td:eq(6)').text();
                const prazoText = linhaClonada.find('td:eq(5)').text();
                const entradaText = linhaClonada.find('td:eq(4)').text();

                const parcelasValue = parseCurrency(parcelasText);
                const prazoValue = parseInt(prazoText);
                const entradaValue = parseCurrency(entradaText);

                const ParcelasTotal = (parcelasValue * prazoValue).toFixed(2);
                const totalValue = ((parcelasValue * prazoValue) + entradaValue).toFixed(2);
                const formattedTotalValue = parseFloat(totalValue).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                const formattedParcelasTotal = parseFloat(ParcelasTotal).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                if ($(this).attr("data-value") === "11") {


                    ///////////////////////////////////////////////////////////////////////////////////////
                    // Itera sobre a linha e verifica se tem data value 11
                    // separa todos os valores de forma organizada para serem calculados.
                    var multiplicadores = [];
                    var valoresMultiplicados = [];
                    var valorTotalMultiplicadores = {};
                    var valorTotalParcelas = {};

                    console.log(parcelasText); // Verifique se parcelasText está correto

                    newCount = parcelasText.split('+').join('>');
                    newCount2 = newCount.split('x').join('>');
                    results = newCount2.split('>');



                    console.log("Multiplicadores:", results);

                    let array1 = [];
                    let array2 = [prazoText];


                    for (let i = 0; i < results.length; i++) {
                        if (i % 2 === 0) {
                            array1.push(results[i]);
                        } else {
                            array2.push(results[i]);
                        }
                    }

                    console.log("Array 1:", array1);
                    console.log("Array 2:", array2);

                    // Função para converter formato "00.000,00" para número
                    function convertToNumber(str) {
                        return parseFloat(str.replace(/\./g, '').replace(',', '.'));
                    }

                    // Converte os valores de array1
                    let convertedArray1 = array1.map(convertToNumber);
                    let convertedArray2 = array2.map(Number);

                    // Formata os valores convertidos de array1 de volta ao formato "00.000,00"
                    let formattedArray1 = convertedArray1.map(formatNumber);

                    let resultArray = [];

                    let minLength = Math.min(convertedArray1.length, convertedArray2.length);

                    for (let i = 0; i < minLength; i++) {
                        resultArray.push(convertedArray1[i] * convertedArray2[i]);
                    }

                    console.log("Array de Resultados:", resultArray);

                    // Somar todos os valores de resultArray
                    let total = resultArray.reduce((accumulator, currentValue) => accumulator + currentValue, 0);
                    let PrazoTotal = convertedArray2.reduce((accumulator, currentValue) => accumulator + currentValue, 0);

                    // Função para formatar número no formato "00.000,00"
                    function formatNumber(value) {
                        return new Intl.NumberFormat('de-DE', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        }).format(value);
                    }

                    let formattedTotal = formatNumber(total);
                    console.log("Valor Total Formatado:", formattedTotal);
                    console.log("Total de parcelas:", PrazoTotal);


                    cabeca.find('td:eq(7)').after('<td>Saldo Devedor</td>');
                    linhaClonada.find('td:eq(0)').css('display', 'none');
                    linhaClonada.find('td:eq(5)').html(PrazoTotal);
                    linhaClonada.find('td:eq(6)').html(`${prazoText}x${parcelasText}`);
                    cabeca.find('td:eq(0)').css('display', 'none');
                    cabeca.find('td:eq(1)').html('Seguimento');

                    linhaClonada.find('td:eq(7)').after(`<td>${formattedTotal} </td>`);


                    const novaTabela = $('<table>').append(cabeca).append(linhaClonada);
                    $('.modal-content').empty().append('<center><p><strong>Informações completas desta cota</strong><br>as parcelas detalhadas desta cota irão aparecer uma abaixo da outra nesta tabela detalhada.</p></center>').append('<button id="shareButton">Compartilhar</button>').append(novaTabela);

                    $('.modal').show();

                    $('#shareButton').on('click', function () {
                        const modalContentHtml = $('.modal-content').html();
                        const encodedHtml = encodeURIComponent(modalContentHtml);
                        //const shareLink = `./share.html?content=${encodedHtml}`;
                        const shareLink = `https://designerluiscoms.com/contemplabens_share?content=${encodedHtml}`;
                        window.open(shareLink, '_blank');
                    });
                } else {
                    linhaClonada.find('td:eq(7)').after(`<td>${formattedParcelasTotal} </td>`);

                    cabeca.find('td:eq(7)').after('<td>Saldo Devedor</td>');
                    linhaClonada.find('td:eq(0)').css('display', 'none');
                    cabeca.find('td:eq(0)').css('display', 'none');
                    cabeca.find('td:eq(1)').html('Seguimento');

                    const novaTabela = $('<table>').append(cabeca).append(linhaClonada);
                    $('.modal-content').empty().append('<center><p><strong>Informações completas desta cota</strong><br>as parcelas detalhadas desta cota irão aparecer uma abaixo da outra nesta tabela detalhada.</p></center>').append('<button id="shareButton">Compartilhar</button>').append(novaTabela);

                    $('.modal').show();

                    $('#shareButton').on('click', function () {
                        const modalContentHtml = $('.modal-content').html();
                        const encodedHtml = encodeURIComponent(modalContentHtml);
                        //const shareLink = `./share.html?content=${encodedHtml}`;
                        const shareLink = `https://designerluiscoms.com/contemplabens_share?content=${encodedHtml}`;
                        window.open(shareLink, '_blank');
                    });
                }
            });

            $('.modal').on('click', function (e) {
                if (e.target === this) {
                    $(this).hide();
                    $('.modal-content').html('');
                }
            });

            function parseCurrency(value) {
                return parseFloat(value.replace(/\./g, '').replace(',', '.'));
            }








            //filtrar valor mínimo de entrada.
            function formatCurrency(value) {
                return value.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            }

            function parseCurrency(value) {
                return parseFloat(value.replace(/\./g, '').replace(',', '.'));
            }

            $(document).ready(function () {

                $('#minValue, #maxValue').on('input', function () {
                    var minValue = parseFloat($('#minValue').val());
                    var maxValue = parseFloat($('#maxValue').val());

                    if (minValue > maxValue) {
                        if ($(this).attr('id') === 'minValue') {
                            $('#maxValue').val(minValue);
                            maxValue = minValue;
                        } else {
                            $('#minValue').val(maxValue);
                            minValue = maxValue;
                        }
                    }

                    $('#minValueDisplay').text(formatCurrency(minValue));
                    $('#maxValueDisplay').text(formatCurrency(maxValue));
                });

                $('#filterBtn').click(function () {

                    // Obter os valores mínimo e máximo
                    var minValue = parseFloat($('#minValue').val());
                    var maxValue = parseFloat($('#maxValue').val());

                    // Iterar sobre as linhas da tabela e filtrar com base nos valores da quinta coluna
                    $('tr').each(function () {
                        function parseCurrency(value) {
                            return parseFloat(value.replace(/\./g, '').replace(',', '.'));
                        }
                        var cellValue = parseCurrency($(this).find('td:eq(4)').text());

                        if (!isNaN(minValue) && !isNaN(maxValue)) {
                            if (cellValue < minValue || cellValue > maxValue) {
                                $(this).hide();
                            } else {
                                $(this).show();
                            }
                        }
                    });
                });
            });






        });










    </script>
    </head>

    <body>

        <!-- Modal -->
        <div class="modal">

            <div class="modal-content">
                <button id="shareButton">Compartilhar</button>
                <!-- Aqui você pode exibir os detalhes da linha selecionada -->
                <!-- Use jQuery para preencher os valores dinamicamente -->
            </div>
        </div>











    </body>



</html>